<?xml version="1.0" encoding="UTF-8"?>

<sql-statement namespace="trading.poci">
	<sql id="splitPageSelect">
		<![CDATA[ 
			SELECT
				poci.*, so.ids AS soids,
				bto.name as orderUnit,
				bto.ids as orderUnitId,
				btm.ids as manufacturerId,
				btm.name as manufacturer,
				so.salesOrderNo,
				so.salesPrice,
				so.freightage,
				so.storag,
				so.other,
				so.pocIds,
				so.orderItemNo,
				t1.hasConfirm as hasConfirm
		]]>
	</sql>
	
	<!-- 分页查询：from -->
	<sql id="splitPageFrom">
		<![CDATA[ 
        	FROM
				b_trading_poci poci
			LEFT JOIN b_trading_salesorder so ON poci.invoceNo = so.orderItemNo
			LEFT JOIN b_trading_manufacturer btm ON so.manufacturer = btm.ids
			LEFT JOIN b_trading_orderunit bto ON so.orderUnit = bto.ids
			LEFT JOIN(
			SELECT
				LEFT (
					orderItemNo,
					length(orderItemNo) - 3
				) as pociInvoceNo,
				SUM(hasConfirm) as sumConfirm,
				COUNT(*) as sum,
				IF (SUM(hasConfirm) = COUNT(*), 1, 0) as hasConfirm
			
			FROM
				b_trading_wiscosettlement
			GROUP BY
				LEFT (
					orderItemNo,
					length(orderItemNo) - 3
				)
			) as t1 ON poci.invoceNo = t1.pociInvoceNo
			WHERE
				1 = 1
			<% if(!isEmpty(invoceNo)){ %>
				and invoceNo like #'%$invoceNo$%'# 
			<% } %>
			<% if(!isEmpty(cDate)){ %>
				and cDate like #'%$cDate$%'# 
			<% } %>
			<% if(!isEmpty(manufacturer)){ %>
				and btm.name like #'%$manufacturer$%'# 
			<% } %>
			<% if(!isEmpty(orderUnit)){ %>
				and bto.name like #'%$orderUnit$%'# 
			<% } %>
			<% if(!isEmpty(salesOrderNo)){ %>
				and so.salesOrderNo like #'%$salesOrderNo$%'# 
			<% } %>
			<% if(!isEmpty(salesPrice)){ %>
				and so.salesPrice like #'%$salesPrice$%'# 
			<% } %>
			<% if(!isEmpty(hasConfirm)){ %>
				and t1.hasConfirm like #'%$hasConfirm$%'# 
			<% } %>
    	]]>
	</sql>
	
</sql-statement>
